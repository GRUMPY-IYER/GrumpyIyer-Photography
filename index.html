<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Grumpy Iyer Viewfinder</title>
  <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;0,600;1,400&family=Amatic+SC:wght@700&display=swap" rel="stylesheet">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --deep-blue: #0f4c75; --purple: #4A148C; --gold: #F57F17; --cream: #f5f5f4; }
    body { font-family: 'Lora', serif; background: var(--cream); color: #1c1917; }
    img { -webkit-user-drag: none; user-select: none; }
    button { cursor: pointer; }
    .app-container { display: flex; min-height: 100vh; }
    .sidebar { width: 280px; background: var(--deep-blue); color: white; position: fixed; height: 100vh; overflow-y: auto; z-index: 100; }
    .sidebar-header { padding: 2rem 1.5rem; text-align: center; }
    .logo-img { width: 180px; }
    .nav-item { padding: 0.875rem 1.5rem; cursor: pointer; border-left: 3px solid transparent; }
    .nav-item:hover { background: rgba(255,255,255,0.1); }
    .nav-item.active { background: rgba(255,255,255,0.15); border-left-color: var(--gold); font-weight: 600; }
    .main-content { margin-left: 280px; flex: 1; }
    .header { background: white; border-bottom: 2px solid var(--deep-blue); padding: 1.5rem 2rem; display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 50; }
    .header h1 { font-family: 'Amatic SC'; font-size: 2rem; color: var(--deep-blue); }
    .btn { padding: 0.625rem 1.25rem; border: none; border-radius: 0.5rem; font-size: 0.875rem; }
    .btn-primary { background: var(--gold); color: white; }
    .btn-secondary { background: var(--purple); color: white; }
    .content { padding: 2rem; max-width: 1400px; margin: 0 auto; }
    .page-title { font-size: 2.5rem; color: var(--deep-blue); margin-bottom: 2rem; }
    .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 2rem; }
    .photo-card { background: white; border-radius: 0.5rem; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; }
    .photo-card img { width: 100%; height: 250px; object-fit: cover; }
    .photo-info { padding: 1.25rem; }
    .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95); z-index: 200; }
    .modal.active { display: flex; align-items: center; justify-content: center; padding: 2rem; }
    .modal-content { background: white; border-radius: 0.5rem; max-width: 1000px; width: 100%; max-height: 90vh; overflow-y: auto; position: relative; }
    .close-btn { position: absolute; top: 1rem; right: 1rem; background: white; border: none; width: 44px; height: 44px; border-radius: 50%; font-size: 1.5rem; z-index: 10; }
    .form-group { margin-bottom: 1rem; }
    .form-group label { display: block; margin-bottom: 0.5rem; font-weight: 600; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 0.75rem; border: 1px solid #e7e5e4; border-radius: 0.5rem; }
  </style>
</head>
<body>
  <div class="app-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="https://via.placeholder.com/180x180/0f4c75/ffffff?text=GI+Logo" class="logo-img" alt="Logo">
      </div>
      <nav>
        <div class="nav-item active" onclick="nav('home')">üè† Home</div>
        <div class="nav-item" onclick="nav('wildlife')">ü¶Å Wildlife</div>
        <div class="nav-item" onclick="nav('landscapes')">üèîÔ∏è Landscapes</div>
        <div class="nav-item" onclick="nav('blog')">‚úçÔ∏è The Viewfinder</div>
        <div class="nav-item" onclick="nav('about')">üìñ About</div>
        <div id="adminNav" class="nav-item" style="display:none;" onclick="nav('admin')">‚öôÔ∏è Admin</div>
      </nav>
    </aside>

    <main class="main-content">
      <header class="header">
        <div>
          <h1>Grumpy Iyer Viewfinder</h1>
        </div>
        <div>
          <button class="btn btn-secondary" onclick="showLogin()">üîí Admin</button>
          <button class="btn btn-secondary" onclick="showCart()">üõí <span id="cartCount"></span></button>
        </div>
      </header>
      <div class="content" id="content"></div>
    </main>
  </div>

  <div id="modal1" class="modal"></div>
  <div id="modal2" class="modal"></div>

  <script>
    var VERSION = 'Oct 21, 2024 - 10:14 PM EST';
    var BUILD = '2024.10.21.003';
    var ADMIN_PASSWORD = 'grumpy2024';
    var CLOUDINARY_CLOUD_NAME = 'dzudd8xbx';
    var CLOUDINARY_UPLOAD_PRESET = 'grumpyiyer_unsigned';
    
    var currentPage = 'home';
    var isAdmin = false;
    var cart = [];
    var photos = JSON.parse(localStorage.getItem('grumpyiyer_photos') || '[]');
    var editingPhoto = null;
    
    function nav(page) {
      console.log('Navigate to:', page);
      var items = document.querySelectorAll('.nav-item');
      for(var i = 0; i < items.length; i++) {
        items[i].classList.remove('active');
      }
      event.target.classList.add('active');
      currentPage = page;
      render();
    }
    
    function render() {
      var content = document.getElementById('content');
      if(currentPage === 'home') {
        content.innerHTML = '<h2 class="page-title">Welcome</h2><div class="gallery-grid" id="gallery"></div>';
        renderGallery(photos);
      } else if(currentPage === 'wildlife') {
        content.innerHTML = '<h2 class="page-title">Wildlife</h2><div class="gallery-grid" id="gallery"></div>';
        var filtered = photos.filter(function(p) { return p.category === 'Wildlife'; });
        renderGallery(filtered);
      } else if(currentPage === 'landscapes') {
        content.innerHTML = '<h2 class="page-title">Landscapes</h2><div class="gallery-grid" id="gallery"></div>';
        var filtered = photos.filter(function(p) { return p.category === 'Landscape'; });
        renderGallery(filtered);
      } else if(currentPage === 'blog') {
        content.innerHTML = '<h2 class="page-title">The Viewfinder</h2><p>Blog coming soon</p>';
      } else if(currentPage === 'about') {
        content.innerHTML = '<h2 class="page-title">About</h2><p>About content</p>';
      } else if(currentPage === 'admin') {
        if(!isAdmin) {
          content.innerHTML = '<p>Please login</p>';
          return;
        }
        content.innerHTML = '<h2 class="page-title">Admin</h2><p>Build: ' + BUILD + '</p><button class="btn btn-primary" onclick="showPhotoForm()">+ Add Photo</button><div id="adminGrid" style="display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:2rem;"></div>';
        renderAdmin();
      }
    }
    
    function renderGallery(list) {
      var html = '';
      for(var i = 0; i < list.length; i++) {
        var p = list[i];
        html += '<div class="photo-card" onclick="openPhoto(' + p.id + ')">';
        html += '<img src="' + p.url + '" alt="' + p.title + '">';
        html += '<div class="photo-info">';
        html += '<h3>' + p.title + '</h3>';
        html += '<p>$' + p.price + '</p>';
        html += '</div></div>';
      }
      document.getElementById('gallery').innerHTML = html || '<p>No photos yet</p>';
    }
    
    function renderAdmin() {
      var html = '';
      for(var i = 0; i < photos.length; i++) {
        var p = photos[i];
        html += '<div style="background:white;padding:1rem;border-radius:0.5rem;">';
        html += '<img src="' + p.url + '" style="width:100%;height:150px;object-fit:cover;border-radius:0.5rem;">';
        html += '<h4>' + p.title + '</h4>';
        html += '<button class="btn btn-secondary" onclick="editPhoto(' + p.id + ')">Edit</button> ';
        html += '<button class="btn btn-primary" onclick="deletePhoto(' + p.id + ')">Delete</button>';
        html += '</div>';
      }
      document.getElementById('adminGrid').innerHTML = html || '<p>No photos</p>';
    }
    
    function showLogin() {
      var modal = document.getElementById('modal1');
      modal.innerHTML = '<div class="modal-content" style="padding:2rem;max-width:400px;" onclick="event.stopPropagation()"><button class="close-btn" onclick="closeModal1()">√ó</button><h2>Admin Login</h2><input type="password" id="pwd" placeholder="Password" style="width:100%;padding:0.75rem;margin:1rem 0;"><button class="btn btn-primary" style="width:100%;" onclick="login()">Login</button></div>';
      modal.classList.add('active');
      modal.onclick = function(e) { if(e.target === modal) closeModal1(); };
    }
    
    function login() {
      var pwd = document.getElementById('pwd').value;
      if(pwd === ADMIN_PASSWORD) {
        isAdmin = true;
        document.getElementById('adminNav').style.display = 'block';
        closeModal1();
        nav('admin');
      } else {
        alert('Wrong password');
      }
    }
    
    function closeModal1() {
      document.getElementById('modal1').classList.remove('active');
    }
    
    function closeModal2() {
      document.getElementById('modal2').classList.remove('active');
    }
    
    function showPhotoForm() {
      var modal = document.getElementById('modal2');
      var html = '<div class="modal-content" style="padding:2rem;max-width:600px;" onclick="event.stopPropagation()">';
      html += '<button class="close-btn" onclick="closeModal2()">√ó</button>';
      html += '<h2>Add Photo</h2>';
      html += '<div class="form-group"><label>Photo</label><input type="file" id="file" accept="image/*"></div>';
      html += '<div class="form-group"><label>Title</label><input type="text" id="title"></div>';
      html += '<div class="form-group"><label>Category</label><select id="category"><option>Wildlife</option><option>Landscape</option></select></div>';
      html += '<div class="form-group"><label>Price</label><input type="number" id="price" value="150"></div>';
      html += '<button class="btn btn-primary" style="width:100%;" onclick="savePhoto()">Save</button>';
      html += '</div>';
      modal.innerHTML = html;
      modal.classList.add('active');
      modal.onclick = function(e) { if(e.target === modal) closeModal2(); };
    }
    
    function savePhoto() {
      var file = document.getElementById('file').files[0];
      if(!file) {
        alert('Select a photo');
        return;
      }
      
      var btn = event.target;
      btn.textContent = 'Uploading...';
      btn.disabled = true;
      
      var formData = new FormData();
      formData.append('file', file);
      formData.append('upload_preset', CLOUDINARY_UPLOAD_PRESET);
      formData.append('folder', 'photography');
      
      fetch('https://api.cloudinary.com/v1_1/' + CLOUDINARY_CLOUD_NAME + '/image/upload', {
        method: 'POST',
        body: formData
      })
      .then(function(r) { return r.json(); })
      .then(function(data) {
        var photo = {
          id: Date.now(),
          title: document.getElementById('title').value,
          category: document.getElementById('category').value,
          price: parseInt(document.getElementById('price').value),
          url: data.secure_url
        };
        photos.push(photo);
        localStorage.setItem('grumpyiyer_photos', JSON.stringify(photos));
        closeModal2();
        render();
      })
      .catch(function() {
        alert('Upload failed');
        btn.textContent = 'Save';
        btn.disabled = false;
      });
    }
    
    function deletePhoto(id) {
      if(confirm('Delete?')) {
        photos = photos.filter(function(p) { return p.id !== id; });
        localStorage.setItem('grumpyiyer_photos', JSON.stringify(photos));
        render();
      }
    }
    
    function openPhoto(id) {
      var p = photos.find(function(x) { return x.id === id; });
      if(!p) return;
      var modal = document.getElementById('modal1');
      var html = '<div class="modal-content" onclick="event.stopPropagation()">';
      html += '<button class="close-btn" onclick="closeModal1()">√ó</button>';
      html += '<img src="' + p.url + '" style="width:100%;max-height:60vh;object-fit:contain;">';
      html += '<div style="padding:2rem;">';
      html += '<h2>' + p.title + '</h2>';
      html += '<p style="font-size:1.5rem;color:var(--gold);margin:1rem 0;">$' + p.price + '</p>';
      html += '<button class="btn btn-primary" onclick="addToCart(' + p.id + ')">Add to Cart</button>';
      html += '</div></div>';
      modal.innerHTML = html;
      modal.classList.add('active');
      modal.onclick = function(e) { if(e.target === modal) closeModal1(); };
    }
    
    function addToCart(id) {
      var p = photos.find(function(x) { return x.id === id; });
      if(!p) return;
      var existing = cart.find(function(item) { return item.id === id; });
      if(existing) {
        existing.quantity++;
      } else {
        cart.push({ id: p.id, title: p.title, price: p.price, url: p.url, quantity: 1 });
      }
      updateCart();
      closeModal1();
    }
    
    function updateCart() {
      var count = 0;
      for(var i = 0; i < cart.length; i++) {
        count += cart[i].quantity;
      }
      document.getElementById('cartCount').textContent = count > 0 ? count : '';
    }
    
    function showCart() {
      var modal = document.getElementById('modal1');
      var html = '<div class="modal-content" style="padding:2rem;max-width:600px;" onclick="event.stopPropagation()">';
      html += '<button class="close-btn" onclick="closeModal1()">√ó</button>';
      html += '<h2>Cart</h2>';
      if(cart.length === 0) {
        html += '<p>Empty</p>';
      } else {
        var total = 0;
        for(var i = 0; i < cart.length; i++) {
          var item = cart[i];
          total += item.price * item.quantity;
          html += '<div style="display:flex;gap:1rem;margin:1rem 0;padding:1rem;background:#f5f5f4;border-radius:0.5rem;">';
          html += '<img src="' + item.url + '" style="width:80px;height:80px;object-fit:cover;border-radius:0.5rem;">';
          html += '<div><h4>' + item.title + '</h4><p>$' + item.price + ' x ' + item.quantity + '</p></div>';
          html += '</div>';
        }
        html += '<div style="border-top:1px solid #e7e5e4;padding-top:1rem;margin-top:1rem;">';
        html += '<p style="font-size:1.25rem;font-weight:600;">Total: $' + total + '</p>';
        html += '<button class="btn btn-primary" style="width:100%;margin-top:1rem;" onclick="alert(\'Checkout coming soon\')">Checkout</button>';
        html += '</div>';
      }
      html += '</div>';
      modal.innerHTML = html;
      modal.classList.add('active');
      modal.onclick = function(e) { if(e.target === modal) closeModal1(); };
    }
    
    document.addEventListener('contextmenu', function(e) { e.preventDefault(); });
    document.addEventListener('keydown', function(e) {
      if((e.ctrlKey || e.metaKey) && e.key === 's') e.preventDefault();
      if(e.key === 'F12') e.preventDefault();
    });
    
    render();
  </script>
</body>
</html>
